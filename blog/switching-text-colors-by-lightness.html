

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Switching text colors in subject to its background color lightness &mdash; Frontend Developer Handbook  documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/zon.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="../_static/zon.ico"/>
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Small Wins: Improving our Document Outline" href="document-outline.html" />
    <link rel="prev" title="Small Wins: Avoid empty containers in Jinja" href="jinja-avoid-empty-containers.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          
<a href="../toc.html">
<img src="../_static/zon.png" class="logo" alt="Logo"/>
 Frontend Developer Handbook
</a>


<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          

            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../index.html">üè†Ô∏è Home</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">‚úçÔ∏è Blog</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="techstack.html">Frontend Tech Stack bei ZEIT ONLINE</a></li>
<li class="toctree-l2"><a class="reference internal" href="jinja-avoid-empty-containers.html">Blog: Avoiding empty containers in Jinja</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Blog: Switching text color by lightness</a></li>
<li class="toctree-l2"><a class="reference internal" href="document-outline.html">Small Wins: Improving our Document Outline (2019-01-08)</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../experiments/index.html">üß™ Experiments</a></li>
<li class="toctree-l1"><a class="reference internal" href="../links/index.html">üåçÔ∏è Links</a></li>
<li class="toctree-l1"><a class="reference internal" href="../practices/index.html">üë©‚Äçüè´ Practices</a></li>
</ul>
<p class="caption"><span class="caption-text">Guidelines</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../javascript/guidelines.html">ZEIT ONLINE JS Coding Guidelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="../jinja/coding-guidelines.html">ZEIT ONLINE Jinja Coding Guidelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sass/guidelines.html">ZEIT ONLINE SASS Coding Guidelines</a></li>
</ul>

            
          


<ul style="margin-top: 2em">
  <li class="toctree-l1"><a class="reference external" href="https://github.com/ZeitOnline/frontend-developer-handbook/edit/master/blog/switching-text-colors-by-lightness.md" target="_blank">Diese Seite editieren</a></li>
</ul>


        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../toc.html">Frontend Developer Handbook</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../toc.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="index.html">ZEIT ONLINE Developer Blog</a> &raquo;</li>
        
      <li>Switching text colors in subject to its background color lightness</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/blog/switching-text-colors-by-lightness.md.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="switching-text-colors-in-subject-to-its-background-color-lightness">
<h1>Switching text colors in subject to its background color lightness<a class="headerlink" href="#switching-text-colors-in-subject-to-its-background-color-lightness" title="Permalink to this headline">¬∂</a></h1>
<p>Sometimes you build a feature with the feeling, there is something that can go wrong afterwards. In this case we built a CMS feature where the editor could decide more or less about the background color of a part of the website. This poses in our thinking a threat to the accessibility of the foreground text, falling behind in contrast in the best case, being completely unreadable in the worst case. No user would certainly choose a black background with black text on it, but what about some of the so loved shades of gray? So‚Ä¶ we looked for a solution to change text colors automatically.</p>
<p>What we found was <a class="reference external" href="https://css-tricks.com/switch-font-color-for-different-backgrounds-with-css/">Switch font color for different backgrounds with CSS</a> over at CSS-Tricks, which uses css variables (and a css math coding trick from hell to achieve conditional statements) to change text colors in subject to its background. But the article also led to the <a class="reference external" href="https://www.w3.org/TR/AERT/#color-contrast">Techniques For Accessibility Evaluation And Repair Tools Working Draft</a> of the W3C, which includes an equation to estimate <em>perceived lightness</em> of colors.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">L</span> <span class="o">=</span> <span class="p">(</span><span class="n">red</span> <span class="o">*</span> <span class="mf">0.299</span> <span class="o">+</span> <span class="n">green</span> <span class="o">*</span> <span class="mf">0.587</span> <span class="o">+</span> <span class="n">blue</span> <span class="o">*</span> <span class="mf">0.114</span><span class="p">)</span> <span class="o">/</span> <span class="mi">255</span>
</pre></div>
</div>
<p>If you put the red, green and blue parts of a color value into the equation you will get a value between 0 and 1, where 0 is perceived as an absolute dark color (black). I would not question the math behind this. All what‚Äôs left to do is to set a threshold value, from which one we think of a color as so dark, that we need to change the foreground color.</p>
<p>This can be certainly achieved with css variables (and the conditional css trick mentioned before) but as we have a broad variety of browsers we need to support that certainly not <a class="reference external" href="https://caniuse.com/#feat=css-variables">support</a> css custom properties yet, we decided to put the equation into a template function of our pythonic template engine <a class="reference external" href="http://jinja.pocoo.org/">jinja2</a>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">colorsys</span>

<span class="k">def</span> <span class="nf">color_is_dark</span><span class="p">(</span><span class="n">hexcolor</span><span class="p">):</span>
    <span class="c1"># takes a hex background color (no shorthands) and computes</span>
    <span class="c1"># if the color is dark in accessiblity context</span>
    <span class="c1"># i.e. a light color needs to be used for contrast</span>
    <span class="c1"># like in light font on dark background</span>
    <span class="n">threshold</span> <span class="o">=</span> <span class="mf">0.6</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">red</span><span class="p">,</span> <span class="n">green</span><span class="p">,</span> <span class="n">blue</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">hexcolor</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">],</span> <span class="mi">16</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
        <span class="c1"># percieved lightness by W3C working draft</span>
        <span class="c1"># https://www.w3.org/TR/AERT/#color-contrast</span>
        <span class="n">l</span> <span class="o">=</span> <span class="p">(</span><span class="n">red</span> <span class="o">*</span> <span class="mf">0.299</span> <span class="o">+</span> <span class="n">green</span> <span class="o">*</span> <span class="mf">0.587</span> <span class="o">+</span> <span class="n">blue</span> <span class="o">*</span> <span class="mf">0.114</span><span class="p">)</span> <span class="o">/</span> <span class="mi">255</span>
        <span class="k">return</span> <span class="n">l</span> <span class="o">&lt;</span> <span class="n">threshold</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">True</span>
</pre></div>
</div>
<p>If the color is defined as dark (lower than 0.6) we add a modifier class to the teaser to change colors of the content:</p>
<div class="highlight-jinja notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">block</span> <span class="nv">teaser_modifier</span> -<span class="cp">%}</span><span class="x"></span>
<span class="x">    </span><span class="cp">{%</span> <span class="k">if</span> <span class="nv">teaser.serie.color</span> -<span class="cp">%}</span><span class="x"></span>
<span class="x">        </span><span class="cp">{{</span> <span class="s1">&#39;teaser--light-text&#39;</span> <span class="k">if</span> <span class="nv">teaser.serie.color</span> <span class="o">|</span> <span class="nf">color_is_dark</span> <span class="cp">}}</span><span class="x"></span>
<span class="x">    </span><span class="cp">{%</span>- <span class="k">endif</span> <span class="cp">%}</span><span class="x"></span>
<span class="cp">{%</span>- <span class="k">endblock</span> <span class="cp">%}</span><span class="x"></span>
</pre></div>
</div>
<p>In the CSS we change now text colors based on the background color, from dark gray on light backgrounds to white on dark backgrounds. For testing purposes we put two versions of the feature on a test page one with light and one with dark background and do a11y tests on them with <a class="reference external" href="https://github.com/mozilla-services/axe-selenium-python">axe</a> and <a class="reference external" href="https://selenium-python.readthedocs.io/">Selenium</a> (we use <a class="reference external" href="https://docs.pytest.org/en/latest/">pytest</a> for these things).</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">axe_selenium_python</span> <span class="kn">import</span> <span class="n">Axe</span>

<span class="k">def</span> <span class="nf">test_podcast_leader_dark_is_accessable</span><span class="p">(</span><span class="n">selenium_driver</span><span class="p">):</span>
    <span class="n">driver</span> <span class="o">=</span> <span class="n">selenium_driver</span>
    <span class="n">driver</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;/zeit-online/index-with-podcast-lead-variations&#39;</span><span class="p">)</span>
    <span class="n">axe</span> <span class="o">=</span> <span class="n">Axe</span><span class="p">(</span><span class="n">driver</span><span class="p">)</span>
    <span class="n">axe</span><span class="o">.</span><span class="n">inject</span><span class="p">()</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">axe</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="s1">&#39;.teaser-podcast-leader&#39;</span><span class="p">,</span> <span class="p">{</span>
        <span class="s1">&#39;runOnly&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;wcag2a&#39;</span><span class="p">,</span> <span class="s1">&#39;wcag2aa&#39;</span><span class="p">,</span> <span class="s1">&#39;wcag2aaa&#39;</span><span class="p">],</span>
        <span class="s1">&#39;resultTypes&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;violations&#39;</span><span class="p">],</span>
        <span class="s1">&#39;rules&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;color-contrast&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;enabled&#39;</span><span class="p">:</span> <span class="s1">&#39;true&#39;</span><span class="p">}</span>
        <span class="p">}</span>
    <span class="p">})</span>

    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;violations&#39;</span><span class="p">))</span> <span class="o">==</span> <span class="mi">0</span>
</pre></div>
</div>
<p>Based on the CSS-Tricks method there is <a class="reference external" href="https://codepen.io/codecandies/pen/QYQLZb/">a codepen</a> to demonstrate the outcome.</p>
<div class="section" id="resources">
<h2>Resources<a class="headerlink" href="#resources" title="Permalink to this headline">¬∂</a></h2>
<div class="section" id="articles">
<h3>Articles<a class="headerlink" href="#articles" title="Permalink to this headline">¬∂</a></h3>
<ul class="simple">
<li><p><a class="reference external" href="https://css-tricks.com/switch-font-color-for-different-backgrounds-with-css/">Switch font color for different backgrounds with CSS</a></p></li>
</ul>
</div>
<div class="section" id="webstandards">
<h3>Webstandards<a class="headerlink" href="#webstandards" title="Permalink to this headline">¬∂</a></h3>
<ul class="simple">
<li><p><a class="reference external" href="https://www.w3.org/TR/AERT/#color-contrast">Techniques For Accessibility Evaluation And Repair Tools Working Draft</a></p></li>
</ul>
</div>
<div class="section" id="tools">
<h3>Tools<a class="headerlink" href="#tools" title="Permalink to this headline">¬∂</a></h3>
<ul class="simple">
<li><p><a class="reference external" href="https://github.com/mozilla-services/axe-selenium-python">axe-selenium-python</a></p></li>
<li><p><a class="reference external" href="https://docs.pytest.org/en/latest/">pytest</a></p></li>
</ul>
<p><em>Written 2019-03-07, Nico Br√ºnjes</em></p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="document-outline.html" class="btn btn-neutral float-right" title="Small Wins: Improving our Document Outline" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="jinja-avoid-empty-containers.html" class="btn btn-neutral float-left" title="Small Wins: Avoid empty containers in Jinja" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright ZEIT ONLINE
      <span class="lastupdated">
        Last updated on Mar 09, 2021.
      </span>

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>